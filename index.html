<!DOCTYPE html>
<html>
  <head>
    <title>Improving Open Source Security with Reproducible Builds</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="rb-style/assets/styles/main.css">
    <link rel="stylesheet" href="assets/customizations.css">
    <link rel="shortcut icon" type="image/png" href="rb-style/assets/images/favicon.png"/>
    <link href="rb-style/assets/fonts/overpass.css" rel="stylesheet">
    <link href="rb-style/assets/fonts/overpass-mono.css" rel="stylesheet">
    <link rel="stylesheet" href="rb-style/assets/static/open-iconic-bootstrap.css" />
    <link rel="stylesheet" href="rb-style/assets/static/bootstrap.min.css">
    <style>
      .remark-code, .remark-inline-code { font-family: 'Overpass Mono'; }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <textarea id="source">
class: center, middle

Improving

# Open Source Security

with

![Reproducible Builds](assets/ReproducibleBuilds_ICONS_4.svg)

---

layout: true

.navbar.navbar-light.rp-navbar__top[![Reproducible Builds](rb-style/assets/images/logo-text-white.png) ![Hacker Hotel](assets/hackerhotel_white.png)]

---

# Agenda

1. Attacks on OSS distribution
2. Defending: Reproducible Builds
3. Other advantages
4. In practice
5. Problems & Tools
6. Arch and Debian

---

# 1. Attacks on OSS distribution

---

## Risk Analysis

Should we care? Would attacks on OSS have impact?

???

TODO Arnout: before we start talking about securing the OSS build and
distribution pipeline, let's talk about whether it is worth it. Spoiler
alert: we think it is.

Show of hands: who is developer? uses OSS? professionally?

Quote Black Duck survey on OSS in bigcorp's

---

## Risk Analysis

Should we care? Are OSS developers being targeted?

???

---

## 

![Homebrew hack](assets/homebrew.png)

![nodejs hack](assets/nodejs.png)

???

Not a theoretical problem:

* august 2018: someone gained access to credentials of Homebrew dev, 

TODO Arnout: add nodejs event-stream thing

Problem not unique to FLOSS: https://www.polygon.com/2018/7/30/17630664/steam-abstractism-cryptocurrency-mining - but FLOSS in unique position to combat it

---

<!-- start include -->

OSS Development and Distribution

<table>
<tr><th>Steps</th><th></th></tr>

<tr><td>
Developers write code
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th></th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
<li>Detect 'rewriting history'</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
<li>Detect 'rewriting history'</li>
<li>Audits</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
<li>Detect 'rewriting history'</li>
<li>Audits</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>
<li>Transitive verification</li>
</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
<li>Detect 'rewriting history'</li>
<li>Audits</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>
<li>Transitive verification</li>
<li>!!!</li>
</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  
---

Threat model

<table>
<tr><th>Threats</th><th>Mitigations</th></tr>

<tr><td>
Developers write code
<ul>
<li>Malicious contributors</li>
<li>Blackmail, coercion</li>
<li>Compromised dev machine</li>
</ul>
</td><td>
<ul>
<li>Cannot be prevented</li>
<li>Can we still improve trust?</li>
</ul>
</td></tr>
   

<tr><td>
Commit to Source Control
<ul>
<li>Compromised SCM hosting</li>
</ul>
</td><td>
<ul>
<li>Signed commits</li>
<li>Detect 'rewriting history'</li>
<li>Audits</li>
</ul>
</td></tr>
   

<tr><td>
Built and packaged
<ul>
<li>Malicious dependencies/plugins</li>
<li>Compromised build machine</li>
</ul>
</td><td>
<ul>
<li>Transitive verification</li>
<li>!!!</li>
</ul>
</td></tr>
   

<tr><td>
Uploaded to distribution infra
<ul>

</ul>
</td><td>
<ul>

</ul>
</td></tr>
   

<tr><td>
Downloaded by user
<ul>
<li>Compromised distribution infra</li>
</ul>
</td><td>
<ul>
<li>Signatures</li>
</ul>
</td></tr>
   

<tr><td>
User runs software
<ul>
<li>No malicious code here</li>
</ul>
</td><td>
<ul>

</ul>
</td></tr>
   
</table>
  

<!-- end include -->

---

"Reflections on Trusting Trust", Ken Thompson, 1984

![Figure 7](assets/trusting-trust.gif)

"Such blatant code would not go undetected for long. Even the most casual perusal of the source of the C compiler would raise suspicions"

???

Not a new problem: envisioned in 1984 by inventor of Unix

TODO Arnout: hoort dit wel hier?

---

# 2. Defending: Reproducible Builds

TODO Arnout: uitleggen wat RB is, plaatjes

---

# 3. Other advantages

* Detect security issues (private key generation on build).
* Less rebuilds due to caching results since they are the same.
* Bugs found in packages when building in different environments.
* Builds which fail X% of the time.

???

TODO Arnout: verder invullen.

---

# 4. In practice

---

# 5. Problems & Tools

---

# Problems

* Dictionary/hash/database ordering
* Build paths
* Timestamps
* Non-determinismistic file ordering
* Users, groups, umask, environment variables, etc.

---

# Tools

* diffoscope
* disorderfs
* reprotest
* strip-nondeterminism

???

* diffoscope - file diff++
* disorderfs - a FUSE fs which introduces non-determinism
* reprotest- build packages twice in different environments
* strip-nondeterminism - build system tool to strip some sorts of non determinism
used by Debian

---

# diffoscope

Also known as diff on steroids


```bash
$ diffoscope badge-firmware.bin /tmp/badge-firmware.bin
│ │       00055f10: 4275 696c 7420 6f6e  test....Built on
│ │       00055f20: 2032 3031 392c 2031  : Feb 13 2019, 1
│ │     - 00055f30: 496e 6974 6961 6c69  5:48:24.Initiali
│ │     + 00055f30: 496e 6974 6961 6c69  5:44:34.Initiali
│ │       00055f40: 2074 6573 7469 6e67  zing and testing
```

https://try.diffoscope.org

???

Diffs two files with support for a lot of formats which are automatically 'unpacked' in the most
convenient format.

---

# reprotest

Builds binaries twice with different variations.

https://packages.debian.org/sid/reprotest

???

Variations such as time, buildpath, disorderfs.

---

# 6. Arch and Debian

* Both have a torture test setup with over 75% reproducible
* Variations differ between distro's
* Focus on user-end-verification

---

# End user verification

1. $distro builds a package
2. Rebuilders verify that the package is reproducible
3. Integration in your package manager
4. Fail installation if a package is not reproducible

---

# End user verification integration

```bash
$ apt install python-pywt-doc
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
python-pywt-doc
0 upgraded, 1 newly installed, 0 to remove and 4 not upgrad
Need to get 102 kB of archives.
After this operation, 978 kB of additional disk space will
WARNING: The following packages are not reproducible!
python-pywt-doc
Install these packages anyway? [y/N]
```

---

# Debian

* Toolchain fixes (GCC, Go, R)
* Packages must be reproducible in a future Debian policy
* Not comparing packages against the archive
* Debian images are not reproducible [#900918](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=900918)


???

* GCC recording buildpath/PGO
* Go?
* R?

---

# Related projects

* [Bootstrappable builds](https://bootstrappable.org/)
* Reproducible PyPi/Java env.
* F-droid reprodicuble APK's
* [in-toto](https://in-toto.github.io)

???

- Bootstrapping languages / OS system from a minimal set of binaries.
- Reproducing Language ecosystems
- Reproducing APK's
- framework to secure the integrity of software supply chains

---

# Get involved

Visit:  [reproducible-builds.org](https://reproducible-builds.org)
Follow: @ReproBuilds on Twitter
Join:   #reproducible-builds (OFTC)

---

    </textarea>
    <script src="js/remark-0.14.1.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
